---
title: "Hands-on 2 - Beyond ggplot2 Fundamentals"
subtitle: "Lesson 2 - Designing Graphs to Enlighten"
editor: visual
date: 20 Jan 2023
date-modified: "`r Sys.Date()`"
code-copy: true
execute: 
  echo: true
  eval: true
  warning: false
  error: false
website: 
    google-analytics: "G-PKMQ2W4ZRC"
format:
  html:
    code-overflow: wrap
    code-fold: true
    code-summary: "Show the code"
    css: styles.css
---

# **1. OVERVIEW**

This study explores the approaches to strengthen data visualisation with [***Tidyverse***](https://www.tidyverse.org/) package.

::: {.callout-tip collapse="true" appearance="simple" icon="false"}
## [**CREDIT**]{style="color:#3a9c88"}

Most content and code chunks within this post are referred from Visual Analytics & Applications lecture notes by Dr Kam Tin Seong, a lecturer who has helped me build confidence in using R / Posit for visual analytics and various applications.
:::

<br>

# **2. R PACKAGE REQUIRED**

## **2.1 Load R Packages**

::: {.callout-tip collapse="true" appearance="simple" icon="false"}
## [**⇳ Usage of the code chunk below :**]{style="color:#3a9c88"}

[***p_load( )*** - pacman -]{style="color:#d46e15"} to load packages into R environment. This function will attempt to install the package from CRAN or pacman repository list if it is not installed.
:::

```{r}
#| code-fold: false
pacman::p_load(tidyverse, patchwork, ggthemes, hrbrthemes, ggrepel) 
```

[ggthemes](https://mran.microsoft.com/snapshot/2016-12-28/web/packages/ggthemes/vignettes/ggthemes.html) provides extension to replicate the look of plots by Edward Tufte, Stephen Few, [Fivethirtyeight](https://fivethirtyeight.com/), [The Economist](https://www.economist.com/graphic-detail), 'Stata', 'Excel', and [The Wall Street Journal](https://www.pinterest.com/wsjgraphics/wsj-graphics/), among others.

<br>

# **3. DATA PREPARATION**

## **3.1 Acquire Data Source**

This study will be based on fictitious data set provided with this lesson.

::: {.callout-tip collapse="true" appearance="simple" icon="false"}
## [**Highlights of the data set**]{style="color:#3a9c88"}

1.  Year end examination grades of a cohort of primary 3 students from a local school.

2.  There are a total of seven attributes. Four of them are categorical data type and the other three are in continuous data type.

-   The categorical attributes are: ID, CLASS, GENDER and RACE.
-   The continuous attributes are: MATHS, ENGLISH and SCIENCE.
:::

## **3.2 Import Data**

### **3.2.1 Import Data**

Involved two (2) steps : import and inspect imported data set.

::: {.callout-tip collapse="true" appearance="simple" icon="false"}
## [**⇳ Usage of the code chunk below :**]{style="color:#3a9c88"}

[***read_csv( )*** - readr -]{style="color:#d46e15"} to read CSV file into a tibble.

[***problems( )*** - readr -]{style="color:#d46e15"} to reveal any parsing errors when importing the CSV file.
:::

```{r}
#| code-fold: false
exam_data <- read_csv("data/Exam_data.csv")

problems(exam_data)
```

### **3.2.2 Inspect Missing Value**

```{r}
skimr::skim(exam_data)
```

<br>

# **4. DATA VISUALISATION**

## **4.1 Plot with Labels & Annotation**

### **4.1.1 Overlapping Issue**

::: {.callout-tip collapse="true" appearance="simple" icon="false"}
## [**⇳ Usage of the code chunk below :**]{style="color:#3a9c88"}

[***geom_label_repel( )*** - ggrepel -]{style="color:#d46e15"} to set the text labels repel away from each other & away from the data points.
:::

::: panel-tabset
## **Annotation Overlapping**

```{r}
#| code-fold: false
#| fig-height: 8
#| fig-width: 14
ggplot(data = exam_data, 
       aes(x = MATHS, 
           y = ENGLISH)) +
  geom_point() +
  geom_smooth(method = lm, 
              size = 0.5) +  
  geom_label(aes(label = ID), 
             hjust = .5, 
             vjust = -.5) +
  coord_cartesian(xlim = c(0,100),
                  ylim = c(0,100)) +
  ggtitle("English scores versus Maths scores for Primary 3")
```

Remarks :

There are many data points overlapped.

## **Fix with *ggrepel***

```{r}
#| code-fold: false
#| fig-height: 8
#| fig-width: 14
ggplot(data = exam_data, 
       aes(x = MATHS, 
           y = ENGLISH)) +
  geom_point() +
  geom_smooth(method = lm, 
              size = 0.5) +  
  geom_label_repel(aes(label = ID), 
                   fontface = "bold") +
  coord_cartesian(xlim = c(0,100),
                  ylim = c(0,100)) +
  ggtitle("English scores versus Maths scores for Primary 3")
```
:::

## **4.2 Theme Options**

This section explores visualisation with 3 themes packages, namely :

1.  ggplot2

2.  ggthemes

3.  patchwork

### **4.2.1 Themes by *ggplot2***
Some of the ggplot2 themes are explored in the hands-on exercise 1. 

```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data, 
             aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  theme_gray() +  
  ggtitle("Distribution of Maths scores") 
```

<br>

### **4.2.2 Themes by *ggthemes***

::: {.callout-tip collapse="true" appearance="simple" icon="false"}
## [**⇳ Usage of the code chunk below :**]{style="color:#3a9c88"}

[***theme_xxx( )*** - ggthemes -]{style="color:#d46e15"} to set themes that not available under ggplot2.

Below are the list of \<xxx\> :

-   theme_base, theme_par, theme_calc, theme_economist, theme excel, theme_few, theme_fivethirtyeight, theme_gdocs, theme_hc, theme_pander, theme_solarized, theme_stata, theme_tufte, theme_wsj

    `theme_base`: a theme resembling the default base graphics in R. See also `theme_par`.

    -   `theme_calc`: a theme based on LibreOffice Calc.

    -   `theme_economist`: a theme based on the plots in the [The Economist](http://www.economist.com/) magazine.

    -   `theme_excel`: a theme replicating the classic ugly gray charts in Excel

    -   `theme_few`: theme from Stephen Few\'s [\"Practical Rules for Using Color in Charts\"](http://www.perceptualedge.com/articles/visual_business_intelligence/rules_for_using_color.pdf).

    -   `theme_fivethirtyeight`: a theme based on the plots at [fivethirtyeight.com](http://fivethirtyeight.com/).

    -   `theme_gdocs`: a theme based on Google Docs.

    -   `theme_hc`: a theme based on [Highcharts JS](http://www.highcharts.com/).

    -   `theme_par`: a theme that uses the current values of the base graphics parameters in `par`.

    -   `theme_pander`: a theme to use with the [pander](http://rapporter.github.io/pander/) package.

    -   `theme_solarized`: a theme using the [solarized](http://ethanschoonover.com/solarized) color palette.

    -   `theme_stata`: themes based on [Stata](http://www.stata.com/) graph schemes.

    -   `theme_tufte`: a minimal ink theme based on Tufte\'s *The Visual Display of Quantitative Information*.

    -   `theme_wsj`: a theme based on the plots in the [The Wall Street Journal](http://www.wsj.com/).
:::

::: panel-tabset
## **theme_wsj (original)**
Based on Wall Street Journal theme.
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_wsj()
```

## **theme_wsj (modify)**
No changes if the color modified with hashcode '#0a89f7'.
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = 'grey25', 
                 fill = 'grey90') +
  ggtitle('Distribution of Maths scores') +
  theme_wsj(color = 'blue')
```

## **theme_tufte**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_tufte()
```

## **theme_stata**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_stata()
```

## **theme_solarized**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_solarized()
```

## **theme_pander**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_pander()
```

## **theme_par**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_par()
```

## **theme_hc**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_hc()
```

## **theme_gdocs**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_gdocs()
```

## **theme_fivethirtyeight**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_fivethirtyeight()
```

## **theme_few**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_few()
```

## **theme_excel**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_excel()
```

## **theme_economist**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_economist()
```

## **theme_calc**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_calc()
```

## **theme_base**
```{r}
#| fig-height: 6
#| fig-width: 14
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_base()
```

:::


### **4.2.3 Themes by ggplot2 :: hrbrthemes**

[hrbrthemes](https://cinc.rud.is/web/packages/hrbrthemes/) package provides a base theme that focuses on typographic elements, including where various labels are placed as well as the fonts that are used.

-   The second goal centers around productivity for a production workflow. In fact, this "production workflow" is the context for where the elements of hrbrthemes should be used. Consult [this vignette](https://cran.r-project.org/web/packages/hrbrthemes/vignettes/why_hrbrthemes.html) to learn more.

```{r}
ggplot(data = exam_data, 
             aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_ipsum()
```

```{r}
ggplot(data = exam_data,
       aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  ggtitle("Distribution of Maths scores") +
  theme_ipsum(axis_title_size = 18, 
              base_size = 15, 
              grid = "Y") 
```

**\
What can we learn from the code chunk below?**

-   `axis_title_size` argument is used to increase the font size of the axis title to 18,

-   `base_size` argument is used to increase the default axis label to 15, and

-   `grid` argument is used to remove the x-axis grid lines.

## 

4.3 Composite Plot with Facet Option

Creating Composite Graphics: pathwork methods

It is not unusual that multiple graphs are required to tell a compelling visual story. There are several ggplot2 extensions provide functions to compose figure with multiple graphs. In this section, I am going to shared with you [**patchwork**](https://patchwork.data-imaginist.com/index.html).

Patchwork package has a very simple syntax where we can create layouts super easily. Here's the general syntax that combines: - Two-Column Layout using the Plus Sign +. - Parenthesis () to create a subplot group. - Two-Row Layout using the Division Sign `\`

create composite plot by combining multiple graphs. First, let us create three statistical graphics.\\

```{r}
p1 <- ggplot(data = exam_data, 
             aes(x = MATHS)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") + 
  coord_cartesian(xlim = c(0,100)) +
  ggtitle("Distribution of Maths scores")
```

```{r}
p2 <- ggplot(data = exam_data, 
             aes(x = ENGLISH)) +
  geom_histogram(bins = 20, 
                 boundary = 100,
                 color = "grey25", 
                 fill = "grey90") +
  coord_cartesian(xlim = c(0,100)) +
  ggtitle("Distribution of English scores")
```

```{r}
p3 <- ggplot(data = exam_data, 
             aes(x = MATHS, 
                 y = ENGLISH)) +
  geom_point() +
  geom_smooth(method = lm, 
              size = 0.5) +  
  coord_cartesian(xlim = c(0,100),
                  ylim = c(0,100)) +
  ggtitle("English scores versus Maths scores for Primary 3")
```

```{r}
p1 + p2 / p3
```

\| will place the plots beside each other, while / will stack them.

```{r}
(p1 / p2) | p3
```

Plot assembly - https://patchwork.data-imaginist.com/articles/guides/assembly.html

### Working with patchwork

**patchwork** also provides auto-tagging capabilities, in order to identify subplots in text:

```{r}
((p1 / p2) | p3) + 
  plot_annotation(tag_levels = 'I')
```

```{r}
patchwork <- (p1 / p2) | p3
patchwork & theme_economist()
```

### Working with patchwork

Beside providing functions to place plots next to each other based on the provided layout. With [`inset_element()`](https://patchwork.data-imaginist.com/reference/inset_element.html) of **patchwork**, we can place one or several plots or graphic elements freely on top or below another plot

```{r}
p3 + inset_element(p2, 
                   left = 0.02, 
                   bottom = 0.7, 
                   right = 0.5, 
                   top = 1)
```

# **7. REFERENCES**

-   T.S. Kam. (2023). Handout lesson material for Hands-on Exercise 2. Singapore Management University. https://isss608-ay2022-23jan.netlify.app/hands-on_ex/hands-on_ex02/hands-on_ex02-beyond_ggplot2#/title-slide

-   [Patchwork R package goes nerd viral](https://www.littlemissdata.com/blog/patchwork)

-   [ggrepel](https://ggrepel.slowkow.com/index.html)

-   [ggthemes](https://ggplot2.tidyverse.org/reference/ggtheme.html)

-   [hrbrthemes](https://cinc.rud.is/web/packages/hrbrthemes/)

-   [ggplot tips: Arranging plots](https://albert-rapp.de/post/2021-10-28-extend-plot-variety/)

-   [ggplot2 Theme Elements Demonstration](https://henrywang.nl/ggplot2-theme-elements-demonstration/)

-   [ggplot2 Theme Elements Reference Sheet](https://isabella-b.com/blog/ggplot2-theme-elements-reference/)
